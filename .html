<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Minimal-strokes QR generator</title>
    <style>
      body {
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
        padding: 24px;
        background: #f7faf7;
        color: #0f172a;
      }
      label,
      button {
        display: block;
        margin-top: 12px;
      }
      input[type="text"] {
        width: 100%;
        padding: 8px;
        font-size: 14px;
        box-sizing: border-box;
      }
      .controls {
        max-width: 720px;
        margin-bottom: 16px;
      }
      .preview {
        border: 1px solid #e6e9ef;
        padding: 14px;
        display: inline-block;
        background: white;
      }
      svg {
        display: block;
      }
      .note {
        margin-top: 10px;
        color: #334155;
        font-size: 13px;
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
  </head>
  <body>
    <h2>QR code generator — low stroke count</h2>
    <div class="controls">
      <label>
        Link / text to encode:
        <input id="text" type="text" value="https://example.com" />
      </label>

      ```
      <label>
        Error correction:
        <select id="ec">
          <option value="L">L — Low</option>
          <option value="M" selected>M — Medium</option>
          <option value="Q">Q — Quartile</option>
          <option value="H">H — High</option>
        </select>
      </label>

      <label>
        Render size (CSS pixels):
        <input id="size" type="text" value="320" />
      </label>

      <label>
        Quiet zone (modules):
        <input id="margin" type="text" value="4" />
      </label>

      <button id="generate">Generate QR</button>
      <button id="download">Download QR</button>

      <div class="note">
        Generates a QR with minimal strokes (one path element).
      </div>
    </div>

    <div>
      <div class="preview" id="container">
        <svg id="qr" width="200" height="200"></svg>
      </div>
    </div>

    <script>
      function buildPathFromMatrix(qr, margin) {
        const moduleCount = qr.getModuleCount();
        const pathParts = [];
        for (let r = 0; r < moduleCount; r++) {
          for (let c = 0; c < moduleCount; c++) {
            if (qr.isDark(r, c)) {
              const x = c + margin;
              const y = r + margin;
              pathParts.push(`M${x} ${y}h1v1h-1z`);
            }
          }
        }
        return pathParts.join("");
      }

      function makeMinimalQRCode(text, ecLevel) {
        for (let type = 1; type <= 40; type++) {
          try {
            const qr = qrcode(type, ecLevel);
            qr.addData(text);
            qr.make();
            return { qr, type };
          } catch (err) {}
        }
        throw new Error("Data too long for QR");
      }

      function renderSVG(qr, svgEl, modulePixelSize, margin, color = "#000") {
        const moduleCount = qr.getModuleCount();
        const totalModules = moduleCount + margin * 2;
        svgEl.setAttribute("viewBox", `0 0 ${totalModules} ${totalModules}`);
        svgEl.innerHTML = "";

        const bg = document.createElementNS(
          "http://www.w3.org/2000/svg",
          "rect"
        );
        bg.setAttribute("width", totalModules);
        bg.setAttribute("height", totalModules);
        bg.setAttribute("fill", "white");
        svgEl.appendChild(bg);

        const path = document.createElementNS(
          "http://www.w3.org/2000/svg",
          "path"
        );
        path.setAttribute("d", buildPathFromMatrix(qr, margin));
        path.setAttribute("fill", color);
        path.setAttribute("shape-rendering", "crispEdges");
        svgEl.appendChild(path);

        svgEl.style.width = modulePixelSize * totalModules + "px";
        svgEl.style.height = modulePixelSize * totalModules + "px";
      }

      document.getElementById("generate").addEventListener("click", () => {
        const text = document.getElementById("text").value.trim();
        if (!text) return alert("Enter text/URL");

        const ec = document.getElementById("ec").value || "L";
        const sizePx =
          parseInt(document.getElementById("size").value, 10) || 320;
        const margin =
          parseInt(document.getElementById("margin").value, 10) || 4;

        try {
          const { qr } = makeMinimalQRCode(text, ec);
          const moduleCount = qr.getModuleCount();
          const totalModules = moduleCount + margin * 2;
          const modulePixelSize = Math.max(
            1,
            Math.floor(sizePx / totalModules)
          );
          renderSVG(qr, document.getElementById("qr"), modulePixelSize, margin);
        } catch (err) {
          alert(err.message);
        }
      });

      // Download QR as PNG
      document.getElementById("download").addEventListener("click", () => {
        const svg = document.getElementById("qr");
        const serializer = new XMLSerializer();
        const svgBlob = new Blob([serializer.serializeToString(svg)], {
          type: "image/svg+xml",
        });
        const url = URL.createObjectURL(svgBlob);

        const img = new Image();
        img.onload = function () {
          const canvas = document.createElement("canvas");
          canvas.width = img.width;
          canvas.height = img.height;
          const ctx = canvas.getContext("2d");
          ctx.drawImage(img, 0, 0);
          URL.revokeObjectURL(url);

          // create PNG download
          const a = document.createElement("a");
          a.download = "qr.png";
          a.href = canvas.toDataURL("image/png");
          a.click();
        };
        img.src = url;
      });

      window.addEventListener("load", () => {
        document.getElementById("generate").click();
      });
    </script>
    ```
  </body>
</html>
